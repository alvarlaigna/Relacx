'use strict';

/*!
 * Relacx v2.0
 *
 * Copyright 2017, Himanshu Tanwar
 * Released under the MIT license
 * https://github.com/webXtended/Relacx
 * Date: 2017-09-19
 */

!function(t,e,o){"undefined"!=typeof module?module.exports=o():"function"==typeof define?define(o):e.Relacx=o()}(0,window,function(){function t(t,e,o){for(var e=e.split("."),n=t,r=1;r<e.length-1;r++)n=n[e[r]];return n[e.pop()]=o,t}function e(){return function(e,o){var n=this,r=[];this.childKeys="root",this.componentController=o,this.constructor.prototype=o,this.action=function(t){var e=Array.prototype.slice.call(arguments);return e.shift(),Function.prototype.bind.apply(this.componentController[t],[n].concat(e))},this.setState=function(o,n){if(n){var r=t(e.state,n,o);r=JSON.parse(JSON.stringify(r)),e.setState(r)}else e.setState(o)},this.getState=function(){return e.state},this.getChildInstances=function(){return r},this.addChildInstance=function(t){r.push(t)}}}function o(t,e){return function(o,n){var r=this,i=e;this.childKeys=e,this.componentController=n,this.action=function(t){var e=Array.prototype.slice.call(arguments);return e.shift(),Function.prototype.bind.apply(this.componentController[t],[r].concat(e))},this.setState=function(e,o){var n=t.props.controller.childKeys;t.props.controller.setState(e,[n,o||i].join("."))}}}function n(t){this.componentName=t}var r={},i={},s=function(t){function e(t){babelHelpers.classCallCheck(this,e);var o=babelHelpers.possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),n={};for(var r in o.props.props)n[r]=o.props.props[r];return o.properties=n,o}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"componentWillMount",value:function(){this.props.parentController&&(this.props.init.prototype.uber=this.props.parentController);var t=new this.props.init(this,this.props.compController);this.controller=t,this.setState(this.props.state),r[this.props.comp.name]&&r[this.props.comp.name].setComponentController(t),this.props.callback&&this.props.callback(t)}},{key:"componentWillReceiveProps",value:function(t){this.setState(t.state)}},{key:"render",value:function(){var t=this.props.comp;return this.properties.controller=this.controller,this.properties.state=this.state,React.createElement(t,this.properties)}}]),e}(React.Component);return n.prototype.setComponentController=function(t){this.componentController=t},n.prototype.addAction=function(t,e){this[t]=e},n.prototype.addActionListener=function(t,e){if(t)for(var o=0;o<t.length;o++)i[t[o]]=i[t[o]]||[],i[t[o]].push({componentName:this.componentName,action:e})},{render:function(t,o,n){var i=e(),p=(r[t.name],React.createElement(s,{init:i,comp:t,props:n.props,state:n.state,callback:n.callback}));if(!o)return p;ReactDOM.render(p,o)},component:function(t,n){(n=n||{}).props=n.props||{},n.state=n.state||{};var i=r[t.name]||{},p=n.parent&&n.childPath?o(n.parent,n.childPath):e();return React.createElement(s,{init:p,comp:t,compController:i,key:n.key,props:n.props,state:n.state})},controller:function(t){if(t){var e=t.name,o=new n(e);return r[e]=o,o}return!1},broadcastAction:function(t,e){for(var o=i[t],n=0;n<o.length;n++){var s=r[o[n].componentName];o[n].action.call(s.componentController,t,e)}}}});
