"use strict";!function(t,e,n){"undefined"!=typeof module?module.exports=n():"function"==typeof define?define(n):e.Relacx=n()}(0,window,function(){function t(e){var n;if(null==e||"object"!=(void 0===e?"undefined":babelHelpers.typeof(e)))return e;if(e instanceof Date)return(n=new Date).setTime(e.getTime()),n;if(e instanceof Array){n=[];for(var o=0,r=e.length;o<r;o++)n[o]=t(e[o]);return n}if(e instanceof Object){n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=t(e[i]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")}function e(t,e,n){for(var e=e.split("."),o=t,r=1;r<e.length-1;r++)o=o[e[r]];var i=e.pop();return o[i]=n[i]||n,t}function n(){return function(n,o){var r=this,i=[];this.childKeys="root",this.componentController=o,this.constructor.prototype=o,this.action=function(t){var e=Array.prototype.slice.call(arguments);return e.shift(),Function.prototype.bind.apply(this.componentController[t],[r].concat(e))},this.setState=function(o,r){if(r){var i=e(n.state,r,o);i=t(i),n.setState(i)}else n.setState(o)},this.getState=function(){return n.state},this.getChildInstances=function(){return i},this.addChildInstance=function(t){i.push(t)}}}function o(t,e){return function(n,o){var r=this,i=e;this.childKeys=e,this.componentController=o,this.action=function(t){var e=Array.prototype.slice.call(arguments);return e.shift(),Function.prototype.bind.apply(this.componentController[t],[r].concat(e))},this.setState=function(e,n){var o=t.props.controller.childKeys;t.props.controller.setState(e,[o,n||i].join("."))},this.getState=function(){return n.state}}}function r(t){this.componentName=t}function i(t,e){for(var n=p[t],o=0;o<n.length;o++){var r=s[n[o].componentName];n[o].action.call(r.componentController,t,e)}}var s={},p={},a=function(t){function e(t){babelHelpers.classCallCheck(this,e);var n=babelHelpers.possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),o={};for(var r in n.props.props)o[r]=n.props.props[r];return n.properties=o,n}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"componentWillMount",value:function(){this.props.parentController&&(this.props.init.prototype.uber=this.props.parentController);var t=new this.props.init(this,this.props.compController);this.controller=t,this.setState(this.props.state),s[this.props.comp.name]&&s[this.props.comp.name].setComponentController(t),this.props.callback&&this.props.callback(t)}},{key:"componentWillReceiveProps",value:function(t){this.setState(t.state)}},{key:"render",value:function(){var t=this.props.comp;return this.properties.controller=this.controller,this.properties.state=this.state,React.createElement(t,this.properties)}}]),e}(React.Component);return r.prototype.setComponentController=function(t){this.componentController=t},r.prototype.addAction=function(t,e){this[t]=e},r.prototype.addActionListener=function(t,e){if(t&&"string"==typeof t)p[t]=p[t]||[],p[t].push({componentName:this.componentName,action:e});else if(t&&t.length)for(var n=0;n<t.length;n++)p[t[n]]=p[t[n]]||[],p[t[n]].push({componentName:this.componentName,action:e})},r.prototype.addBroadcastAction=function(t,e){this[t]=function(){var n=Array.prototype.slice.call(arguments),o=e.apply(this,n);i(t,o)}},{render:function(t,e,o){var r=n();s[t.name];o.props=o.props||{},o.state=o.state||{};var i=React.createElement(a,{init:r,comp:t,props:o.props,state:o.state,callback:o.callback});if(!e)return i;ReactDOM.render(i,e,function(){o.afterRender&&"function"==typeof o.afterRender&&o.afterRender()})},component:function(t,e){(e=e||{}).props=e.props||{},e.state=e.state||{};var r=s[t.name]||{},i=e.parent&&e.childPath?o(e.parent,e.childPath):n();return React.createElement(a,{init:i,comp:t,compController:r,key:e.key,props:e.props,state:e.state})},controller:function(t){if(t){var e=t.name,n=new r(e);return s[e]=n,n}return!1},broadcastAction:i}});