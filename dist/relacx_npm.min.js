function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var React=require("react"),ReactDOM=require("react-dom"),_createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Relacx=e()}(this,function(){function t(e){var o;if(null==e||"object"!=(void 0===e?"undefined":_typeof(e)))return e;if(e instanceof Date)return(o=new Date).setTime(e.getTime()),o;if(e instanceof Array){o=[];for(var n=0,r=e.length;n<r;n++)o[n]=t(e[n]);return o}if(e instanceof Object){o={};for(var i in e)e.hasOwnProperty(i)&&(o[i]=t(e[i]));return o}throw new Error("Unable to copy obj! Its type isn't supported.")}function e(t,e,o){for(var n,e=e.split("."),r=t,i=1;i<e.length-1;i++)void 0===r[n=e[i]]&&(r[n]={}),r=r[n];return r[e.pop()]=o,t}function o(){return function(o,n){var r=this,i=[];this.childKeys="root",this.componentController=n,this.constructor.prototype=n,this.action=function(t){var e=Array.prototype.slice.call(arguments);return e.shift(),Function.prototype.bind.apply(this.componentController[t],[r].concat(e))},this.setState=function(n,r){if(r){var i=e(o.state,r,n);i=t(i),o.setState(i)}else o.setState(n)},this.getState=function(){return o.state},this.getChildInstances=function(){return i},this.addChildInstance=function(t){i.push(t)}}}function n(t,e){return function(o,n){var r=this,i=e;this.childKeys=e,this.componentController=n,this.action=function(t){var e=Array.prototype.slice.call(arguments);return e.shift(),Function.prototype.bind.apply(this.componentController[t],[r].concat(e))},this.setState=function(e,o){var n=t.props.controller.childKeys;t.props.controller.setState(e,[n,o||i].join("."))},this.getState=function(){return o.state}}}function r(t){this.componentName=t}function i(t,e){for(var o=this,n=c[t],r=0;r<n.length;r++)!function(r){for(var i=s[n[r].componentName],p=0;p<i.length;p++)!function(p){setTimeout(function(o){o.action.call(i[p],t,e)}.bind(o,n[r]),0)}(p)}(r)}var p={},s={},c={},a=function(t){function e(t){_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),n={};for(var r in o.props.props)n[r]=o.props.props[r];return o.properties=n,o}return _inherits(e,React.Component),_createClass(e,[{key:"componentWillMount",value:function(){this.props.parentController&&(this.props.init.prototype.uber=this.props.parentController);var t=new this.props.init(this,this.props.compController);this.controller=t,this.setState(this.props.state),p[this.props.comp.name]&&(p[this.props.comp.name].setComponentController(t),s[this.props.comp.name]=s[this.props.comp.name]||[],s[this.props.comp.name].push(t)),this.props.callback&&this.props.callback(t)}},{key:"componentWillReceiveProps",value:function(t){this.setState(t.state)}},{key:"render",value:function(){var t=this.props.comp;return this.properties.controller=this.controller,this.properties.state=this.state,React.createElement(t,this.properties)}}]),e}();return r.prototype.setComponentController=function(t){this.componentController=t},r.prototype.addAction=function(t,e){this[t]=e},r.prototype.addActionListener=function(t,e){if(t&&"string"==typeof t)c[t]=c[t]||[],c[t].push({componentName:this.componentName,action:e});else if(t&&t.length)for(var o=0;o<t.length;o++)c[t[o]]=c[t[o]]||[],c[t[o]].push({componentName:this.componentName,action:e})},r.prototype.addBroadcastAction=function(t,e){this[t]=function(){var o=Array.prototype.slice.call(arguments),n=e.apply(this,o);i(t,n)}},{render:function(t,e,n){var r=o(),i=p[t.name]||{};(n=n||{}).props=n.props||{},n.state=n.state||{};var s=React.createElement(a,{init:r,comp:t,compController:i,props:n.props,state:n.state,callback:n.callback});if(!e)return s;ReactDOM.render(s,e,function(){n.afterRender&&"function"==typeof n.afterRender&&n.afterRender()})},component:function(t,e){(e=e||{}).props=e.props||{},e.state=e.state||{};var r=p[t.name]||{},i=e.parent&&e.childPath?n(e.parent,e.childPath):o();return React.createElement(a,{init:i,comp:t,compController:r,key:e.key,props:e.props,state:e.state})},controller:function(t){if(t){var e=t.name,o=new r(e);return p[e]=o,o}return!1},broadcastAction:i}});