/*!
 * Relacx v2.0
 *
 * Copyright 2017, Himanshu Tanwar
 * Released under the MIT license
 * https://github.com/webXtended/Relacx
 * Date: 2017-09-19
 */
"use strict";!function(t,e,n){"undefined"!=typeof module?module.exports=n():"function"==typeof define?define(n):e[t]=n()}("Relacx",window,function(){function t(e){var n;if(null==e||"object"!=("undefined"==typeof e?"undefined":babelHelpers["typeof"](e)))return e;if(e instanceof Date)return n=new Date,n.setTime(e.getTime()),n;if(e instanceof Array){n=[];for(var o=0,r=e.length;r>o;o++)n[o]=t(e[o]);return n}if(e instanceof Object){n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=t(e[i]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")}function e(t,e,n){for(var o,e=e.split("."),r=t,i=1;i<e.length-1;i++)o=e[i],r=r[o];var s=e.pop();return r[s]=n[s]||n,t}function n(){function n(n,o){var r=this,i=[];this.childKeys="root",this.componentController=o,this.constructor.prototype=o,this.action=function(t){var e=Array.prototype.slice.call(arguments);e.shift();var n=Function.prototype.bind.apply(this.componentController[t],[r].concat(e));return n},this.setState=function(o,r){if(r){var i=e(n.state,r,o);i=t(i),n.setState(i)}else n.setState(o)},this.getState=function(){return n.state},this.getChildInstances=function(){return i},this.addChildInstance=function(t){i.push(t)}}return n}function o(t,e){function n(n,o){var r=this,i=e;this.childKeys=e,this.componentController=o,this.action=function(t){var e=Array.prototype.slice.call(arguments);e.shift();var n=Function.prototype.bind.apply(this.componentController[t],[r].concat(e));return n},this.setState=function(e,n){var o=t.props.controller.childKeys;t.props.controller.setState(e,[o,n||i].join("."))},this.getState=function(){return n.state}}return n}function r(t,e,o){var r=n();c[t.name]||{};o.props=o.props||{},o.state=o.state||{};var i=React.createElement(u,{init:r,comp:t,props:o.props,state:o.state,callback:o.callback});return e?void ReactDOM.render(i,e,function(){o.afterRender&&"function"==typeof o.afterRender&&o.afterRender()}):i}function i(t,e){e=e||{},e.props=e.props||{},e.state=e.state||{};var r=c[t.name]||{},i=e.parent&&e.childPath?o(e.parent,e.childPath):n(),s=React.createElement(u,{init:i,comp:t,compController:r,key:e.key,props:e.props,state:e.state});return s}function s(t){if(t){var e=t.name,n=new p(e);return c[e]=n,n}return!1}function p(t){this.componentName=t}function a(t,e){for(var n=l[t],o=0;o<n.length;o++){var r=c[n[o].componentName];n[o].action.call(r.componentController,t,e)}}var c={},l={},u=function(t){function e(t){babelHelpers.classCallCheck(this,e);var n=babelHelpers.possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),o={};for(var r in n.props.props)o[r]=n.props.props[r];return n.properties=o,n}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"componentWillMount",value:function(){this.props.parentController&&(this.props.init.prototype.uber=this.props.parentController);var t=new this.props.init(this,this.props.compController);this.controller=t,this.setState(this.props.state),c[this.props.comp.name]&&c[this.props.comp.name].setComponentController(t),this.props.callback&&this.props.callback(t)}},{key:"componentWillReceiveProps",value:function(t){this.setState(t.state)}},{key:"render",value:function(){var t=this.props.comp;return this.properties.controller=this.controller,this.properties.state=this.state,React.createElement(t,this.properties)}}]),e}(React.Component);return p.prototype.setComponentController=function(t){this.componentController=t},p.prototype.addAction=function(t,e){this[t]=e},p.prototype.addActionListener=function(t,e){if(t&&"string"==typeof t)l[t]=l[t]||[],l[t].push({componentName:this.componentName,action:e});else if(t&&t.length)for(var n=0;n<t.length;n++)l[t[n]]=l[t[n]]||[],l[t[n]].push({componentName:this.componentName,action:e})},p.prototype.addBroadcastAction=function(t,e){this[t]=function(){var n=Array.prototype.slice.call(arguments),o=e.apply(this,n);a(t,o)}},{render:r,component:i,controller:s,broadcastAction:a}});